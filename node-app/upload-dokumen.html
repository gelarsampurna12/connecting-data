<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Upload Dokumen Sekolah</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 py-10">
  <div class="max-w-xl mx-auto bg-white p-8 shadow rounded">
    <h2 class="text-2xl font-bold mb-6 text-center text-gray-700">Upload Dokumen Sekolah</h2>
    
    <form id="formDokumen" enctype="multipart/form-data" class="space-y-4">
      <div>
        <label class="block font-semibold mb-1 text-gray-700">Nama File</label>
        <input type="text" name="nama" required class="w-full px-4 py-2 border rounded focus:outline-none focus:ring focus:border-blue-300" />
      </div>

      <div>
        <label class="block font-semibold mb-1 text-gray-700">Kategori</label>
        <select name="kategori" id="kategori" required class="w-full px-4 py-2 border rounded focus:outline-none focus:ring focus:border-blue-300">
          <option value="">-- Pilih Kategori --</option>
          <option value="kurikulum">Kurikulum</option>
          <option value="kesiswaan">Kesiswaan</option>
          <option value="kesiswaan_prestasi">Kesiswaan - Prestasi</option>
          <option value="kesiswaan_ekskul">Kesiswaan - Ekskul</option>
          <option value="ketata_usahaan">Ketata Usahaan</option>
          <option value="humas">Humas</option>
          <option value="sarpras">Sarpras</option>
        </select>
      </div>

      <!-- hidden input subkategori -->
      <input type="hidden" name="subkategori" id="subkategori" />

      <div>
        <label class="block font-semibold mb-1 text-gray-700">Pilih File</label>
        <input type="file" name="file" required class="w-full" />
      </div>

      <button type="submit" class="bg-blue-600 hover:bg-blue-700 transition text-white px-4 py-2 rounded w-full font-semibold">
        Upload Dokumen
      </button>
    </form>

    <div id="hasil" class="mt-6"></div>
  </div>

  <script>
    const kategoriSelect = document.getElementById("kategori");
    const subkategoriInput = document.getElementById("subkategori");

    kategoriSelect.addEventListener("change", () => {
      const val = kategoriSelect.value;
      if (val.includes("_")) {
        const [kategoriUtama, sub] = val.split("_");
        kategoriSelect.value = kategoriUtama;
        subkategoriInput.value = sub;
      } else {
        subkategoriInput.value = "";
      }
    });

    document.getElementById("formDokumen").addEventListener("submit", async (e) => {
      e.preventDefault();

      const form = e.target;
      const formData = new FormData(form);
      const hasilEl = document.getElementById("hasil");

      try {
        const res = await fetch("http://localhost:3000/upload-dokumen", {
          method: "POST",
          body: formData
        });

        const hasil = await res.json();

        if (res.ok && hasil.data) {
          const data = hasil.data;
          hasilEl.innerHTML = `
            <div class="p-4 bg-green-100 text-green-800 rounded shadow">
              ‚úÖ Dokumen <strong>${data.nama}</strong> berhasil diupload.<br/>
              üìÅ Kategori: <strong>${data.kategori}</strong>${data.subkategori ? " / " + data.subkategori : ""}
            </div>
          `;
          form.reset();
        } else {
          throw new Error(hasil.error || "Gagal mengupload dokumen");
        }

      } catch (err) {
        hasilEl.innerHTML = `
          <div class="p-4 bg-red-100 text-red-700 rounded shadow">
            ‚ùå ${err.message}
          </div>
        `;
      }
    });
  </script>
</body>
</html>
